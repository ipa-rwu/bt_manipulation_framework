<launch>
	<!-- camera driver node -->
	<arg name="use_pointcloud"	   default="false" />
	<arg name="camera_namespace" default="camera"/>
	<arg name="marker_frame_id"     default="base_link"/>

	<arg name="marker_size" default="2" />
	<arg name="max_new_marker_error" default="0.08" />
	<arg name="max_track_error" default="0.2" />

  	<group unless="$(arg use_pointcloud)">
		<arg name="cam_image_topic" default="$(arg camera_namespace)/color/image_raw" />
		<arg name="cam_info_topic" default="$(arg camera_namespace)/color/camera_info" />

		<!-- realsense node -->
		<include file="$(find realsense2_camera)/launch/rs_camera.launch">
			<arg name="camera"                value="$(arg camera_namespace)"/>
			<arg name="enable_pointcloud"     value="false" />
			<arg name="output"              value="log"/>
		</include>

		<!-- Ar_alvar_tracker node -->
		<node name="ar_track_alvar" pkg="ar_track_alvar" type="individualMarkersNoKinect" respawn="false">
			<param name="marker_size"           type="double" value="$(arg marker_size)" />
			<param name="max_new_marker_error"  type="double" value="$(arg max_new_marker_error)" />
			<param name="max_track_error"       type="double" value="$(arg max_track_error)" />
			<param name="output_frame"          type="string" value="$(arg marker_frame_id)" />

			<remap from="camera_image"  to="$(arg cam_image_topic)" />
			<remap from="camera_info"   to="$(arg cam_info_topic)" />
		</node>
	</group>

  	<group if="$(arg use_pointcloud)">
		<arg name="cam_image_topic" default="$(arg camera_namespace)/depth/color/points" />
		<arg name="cam_info_topic" default="$(arg camera_namespace)/color/camera_info" />

		<include file="$(find realsense2_camera)/launch/rs_camera.launch">
			<arg name="camera"                value="$(arg camera_namespace)"/>
			<arg name="enable_pointcloud"     value="true" />
		</include>

		<node name="ar_track_alvar" pkg="ar_track_alvar" type="individualMarkers" respawn="false" output="log">
			<param name="marker_size"           type="double" value="$(arg marker_size)" />
			<param name="max_new_marker_error"  type="double" value="$(arg max_new_marker_error)" />
			<param name="max_track_error"       type="double" value="$(arg max_track_error)" />
			<param name="output_frame"          type="string" value="$(arg marker_frame_id)" />

			<remap from="camera_image"  to="$(arg cam_image_topic)" />
			<remap from="camera_info"   to="$(arg cam_info_topic)" />
		</node>
	</group>


	<node pkg="ar_marker_detector" type="find_objects.py" name="skill_find_objects_server" output="screen">
	</node> 

</launch>
